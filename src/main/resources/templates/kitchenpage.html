<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KitchenConnect - Kitchen</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" th:href="@{/images/favicon_io/favicon-16x16.png}">
    <link rel="stylesheet" th:href="@{/css/kitchenpage.css}">

</head>
<body>
    <!-- Include Header -->
    <div th:replace="~{fragments/header :: header}"></div>

    <!-- Kitchen Section -->
    <main class="container main">
        <!-- Restaurant Profile and About My Kitchen Combined -->
        <div class="card">
         <div class="flex flex-col items-center">
          <img alt="Restaurant" class="h-48 w-64 rounded-lg object-cover" height="200" th:src="@{'/images/kitchens/' + ${kitchen.kitchenImage}}" width="300"/>
          <h2 th:text="${kitchen.kitchenName}"></h2>
          <p>
           Specialty: <span th:text="${kitchen.speciality}"></span>
          </p>
          <div class="rating">
            <i class="fas fa-star"></i>
           <span th:text="${kitchen.overallRating}"></span>
           <span>(<span th:text="${kitchen.totalRatingsCount}"></span> reviews)</span>
          </div>
         </div>
         <div class="info">
          <h3>
           About Our Kitchen
          </h3>
          <p th:text="${kitchen.kitchenDescription}"></p>
          <div class="details">
           <div class="detail">
            <div>
              <p>
                <i class="fas fa-utensils"></i>
              </p>
              <p>
               Managed By
              </p>
            </div>
            <p>
             <a th:href="@{'/chef/' + ${chefId}}" class="text-decoration-none">Chef <span th:text="${chefName}"></span></a>
            </p>
           </div>
           <div class="detail">
            <div>
              <p>
                <i class="fas fa-clock"></i>
              </p>
              <p>
               Delivered In
              </p>
            </div>
            <p>
              <span th:text="${kitchen.minDeliveryTime} + '-' + ${kitchen.maxDeliveryTime} + ' mins'"></span>
            </p>
           </div>
           <div class="detail">
            <div>
              <p>
                <i class="fas fa-calendar-check"></i>
              </p>
              <p>
               Available Days
              </p>
            </div>
            <p th:text="${kitchen.availableDays}"></p>
           </div>
           <div class="detail">
            <div>
              <p>
                <i class="fas fa-money-bill-wave"></i>
              </p>
              <p>
               Delivery Fees
              </p>
            </div>
            <p th:text="'Rs ' + ${kitchen.deliveryFees}"></p>
           </div>
          </div>
         </div>
        </div>
        <!-- Menu -->
        <div class="menu">
        <h3>Menu</h3>
         <div class="items">
          <!-- Menu Items -->
          <div class="item" th:each="foodItem : ${menuItems}">
           <div>
            <img th:alt="${foodItem.name}" class="card-img-top" th:src="@{'/images/food/' + ${foodItem.picture}}">
            <h4 th:text="${foodItem.name}"></h4>
            <p th:text="${foodItem.description}"></p>
           </div>
           <div class="card-bottom-section">
            <div class="price-rating">
              <div class="price">
               <span th:text="'Rs ' + ${foodItem.price}"></span>
               <span th:class="${foodItem.availability} ? 'status' : 'status sold-out'"
                  th:text="${foodItem.availability} ? 'Available' : 'Sold Out'">
                </span>
              </div>
              <div class="rating">
               <i class="fas fa-star">
               </i>
               <span th:text="${foodItem.overallRating}"></span>
               <span>
                (<span th:text="${foodItem.ratingCount}"></span>)
               </span>
              </div>
             </div>
             <div th:id="'cart-button-container-' + ${foodItem.id}">
              <button th:id="'addToCart-' + ${foodItem.id}" class="add-to-cart" th:onclick="'toggleCart(' + ${foodItem.id} + ')'">
                  Add to Cart
              </button>
             </div>
           </div>
          </div>
         </div>
        </div>
       </main>

    <!-- Include Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>


    <script>
      function toggleCart(foodItemId) {
        let container = document.getElementById(`cart-button-container-${foodItemId}`);
        console.log("id",foodItemId)
    
        // Create new elements
        let minusBtn = document.createElement("button");
        minusBtn.innerText = "-";
        minusBtn.classList.add("cart-btn");
        minusBtn.onclick = function () { decreaseCount(foodItemId); };
    
        let countDisplay = document.createElement("span");
        countDisplay.innerText = "1";
        countDisplay.classList.add("count");
        countDisplay.id = `itemCount-${foodItemId}`;
    
        let plusBtn = document.createElement("button");
        plusBtn.innerText = "+";
        plusBtn.classList.add("cart-btn");
        plusBtn.onclick = function () { increaseCount(foodItemId); };
    
        // Replace existing button with new UI
        container.innerHTML = "";
        container.appendChild(minusBtn);
        container.appendChild(countDisplay);
        container.appendChild(plusBtn);

        updateCart(foodItemId, 1);
      }
    
    function decreaseCount(foodItemId) {
        let countDisplay = document.getElementById(`itemCount-${foodItemId}`);
        let count = parseInt(countDisplay.innerText);
    
        if (count > 1) {
            countDisplay.innerText = count - 1;
            updateCart(foodItemId, count - 1);
        } else {
            // Restore "Add to Cart" button when count reaches 0
            document.getElementById(`cart-button-container-${foodItemId}`).innerHTML = 
                `<button id="addToCart-${foodItemId}" class="add-to-cart" onclick="toggleCart(${foodItemId})">
                    Add to Cart
                </button>`;
            updateCart(foodItemId, 0);
        }
    }
    
    function increaseCount(foodItemId) {
        let countDisplay = document.getElementById(`itemCount-${foodItemId}`);
        let count = parseInt(countDisplay.innerText);
        countDisplay.innerText = count + 1;
        updateCart(foodItemId, count + 1);
    }

    function updateCart(foodItemId, quantity) {
      fetch('/cart/update', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({ foodItemId: foodItemId, quantity: quantity })
      })
      .then(response => response.text())
      .then(data => console.log("Session Cart Updated:", data))
      .catch(error => console.error("Error updating cart:", error));
    }
    
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>